<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ú–∞–≥–∏–µ–π ‚ú®</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; margin-bottom: 20px; }
        h2 { margin-top: 0; color: #248bcf; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
        .btns-row { display: flex; gap: 10px; }
        .btn-main { background: #248bcf; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; }
        .btn-cancel { background: #adb5bd; width: 30%; }
        
        table { width: 100%; max-width: 900px; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #248bcf; color: white; }
        .actions-btns { display: flex; gap: 5px; }
        .btn-sm { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: bold; font-size: 12px; }
        .edit { background: #f39c12; }
        .del { background: #e84118; }
    </style>
</head>
<body>

    <div class="card">
        <h2 id="form-title">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–∞–¥–∫—É üîÆ</h2>
        <input type="hidden" id="edit-id">
        <select id="category">
            <option value="–ª—ë–≥–∫–∏–µ">üçÑ –õ—ë–≥–∫–∏–µ</option>
            <option value="—Å–ª–æ–∂–Ω—ã–µ">üåã –°–ª–æ–∂–Ω—ã–µ</option>
            <option value="—Å –ø–æ–¥–≤–æ—Ö–æ–º">üîÆ –° –ø–æ–¥–≤–æ—Ö–æ–º</option>
        </select>
        <textarea id="question" rows="3" placeholder="–¢–µ–∫—Å—Ç –∑–∞–≥–∞–¥–∫–∏..."></textarea>
        <input type="text" id="answer" placeholder="–û–¢–í–ï–¢">
        <div class="btns-row">
            <button id="btn-save" class="btn-main" onclick="saveRiddle()">–°–û–•–†–ê–ù–ò–¢–¨</button>
            <button id="btn-cancel" class="btn-main btn-cancel" style="display:none;" onclick="cancelEdit()">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th>–ó–∞–≥–∞–¥–∫–∞</th>
                <th>–û—Ç–≤–µ—Ç</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody id="riddles-list"></tbody>
    </table>

    <script>
        let allRiddles = [];

        window.onload = loadRiddles;

        async function loadRiddles() {
            const res = await fetch('/api/admin/riddles');
            allRiddles = await res.json();
            const list = document.getElementById('riddles-list');
            list.innerHTML = '';

            allRiddles.forEach(r => {
                list.innerHTML += `
                    <tr>
                        <td><b>${r.category}</b></td>
                        <td>${r.question.substring(0, 40)}...</td>
                        <td><u>${r.answer}</u></td>
                        <td class="actions-btns">
                            <button class="btn-sm edit" onclick="editRiddle(${r.id})">‚úé</button>
                            <button class="btn-sm del" onclick="deleteRiddle(${r.id})">‚úñ</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function saveRiddle() {
            const id = document.getElementById('edit-id').value;
            const body = {
                question: document.getElementById('question').value,
                answer: document.getElementById('answer').value,
                category: document.getElementById('category').value
            };

            const url = id ? `/api/riddles/${id}` : '/api/riddles';
            const method = id ? 'PUT' : 'POST';

            const res = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            if (res.ok) {
                cancelEdit();
                loadRiddles();
            } else { alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!"); }
        }

        function editRiddle(id) {
            const r = allRiddles.find(item => item.id === id);
            document.getElementById('edit-id').value = r.id;
            document.getElementById('question').value = r.question;
            document.getElementById('answer').value = r.answer;
            document.getElementById('category').value = r.category;
            
            document.getElementById('form-title').innerText = "–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–≥–∞–¥–∫—É üìù";
            document.getElementById('btn-save').innerText = "–û–ë–ù–û–í–ò–¢–¨";
            document.getElementById('btn-cancel').style.display = 'block';
            window.scrollTo(0,0);
        }

        function cancelEdit() {
            document.getElementById('edit-id').value = '';
            document.getElementById('question').value = '';
            document.getElementById('answer').value = '';
            document.getElementById('form-title').innerText = "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–∞–¥–∫—É üîÆ";
            document.getElementById('btn-save').innerText = "–°–û–•–†–ê–ù–ò–¢–¨";
            document.getElementById('btn-cancel').style.display = 'none';
        }

        async function deleteRiddle(id) {
            if (!confirm("–£–¥–∞–ª–∏—Ç—å?")) return;
            await fetch(`/api/admin/riddles/${id}`, { method: 'DELETE' });
            loadRiddles();
        }
    </script>
</body>
</html>
