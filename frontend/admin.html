<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –í–∏–∫—Ç–æ—Ä–∏–Ω—ã</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; margin-bottom: 30px; }
        select, textarea, input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
        .btn-save { background: #248bcf; color: white; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; }
        .btn-cancel { background: #999; margin-top: 5px; }
        
        table { width: 100%; max-width: 900px; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #248bcf; color: white; }
        .actions { display: flex; gap: 8px; }
        .btn-edit { background: #f39c12; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; }
        .btn-del { background: #e84118; color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="card">
        <h2 id="form-title">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–∞–¥–∫—É üîÆ</h2>
        <input type="hidden" id="edit-id">
        <select id="category">
            <option value="–ª—ë–≥–∫–∏–µ">üçÑ –õ—ë–≥–∫–∏–µ</option>
            <option value="—Å–ª–æ–∂–Ω—ã–µ">üåã –°–ª–æ–∂–Ω—ã–µ</option>
            <option value="—Å –ø–æ–¥–≤–æ—Ö–æ–º">üîÆ –° –ø–æ–¥–≤–æ—Ö–æ–º</option>
        </select>
        <textarea id="question" rows="3" placeholder="–¢–µ–∫—Å—Ç –∑–∞–≥–∞–¥–∫–∏..."></textarea>
        <input type="text" id="answer" placeholder="–û–¢–í–ï–¢">
        <textarea id="explanation" rows="2" placeholder="–ü–æ—è—Å–Ω–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)..."></textarea>
        
        <button id="btn-save" class="btn-save" onclick="saveRiddle()">–°–û–•–†–ê–ù–ò–¢–¨</button>
        <button id="btn-cancel" class="btn-save btn-cancel" style="display:none" onclick="cancelEdit()">–û–¢–ú–ï–ù–ê</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>–ö–∞—Ç.</th>
                <th>–ó–∞–≥–∞–¥–∫–∞</th>
                <th>–û—Ç–≤–µ—Ç</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody id="riddles-list"></tbody>
    </table>

    <script>
        let allRiddles = [];

        window.onload = loadRiddles;

        async function loadRiddles() {
            const res = await fetch('/api/admin/riddles');
            allRiddles = await res.json();
            const list = document.getElementById('riddles-list');
            list.innerHTML = '';

            allRiddles.forEach(r => {
                list.innerHTML += `
                    <tr>
                        <td><b>${r.category}</b></td>
                        <td>${r.question.substring(0, 40)}...</td>
                        <td>${r.answer}</td>
                        <td class="actions">
                            <button class="btn-edit" onclick="editRiddle(${r.id})">‚úé</button>
                            <button class="btn-del" onclick="deleteRiddle(${r.id})">‚úñ</button>
                        </td>
                    </tr>
                `;
            });
        }

        async function saveRiddle() {
            const id = document.getElementById('edit-id').value;
            const body = {
                question: document.getElementById('question').value,
                answer: document.getElementById('answer').value,
                category: document.getElementById('category').value,
                explanation: document.getElementById('explanation').value
            };

            const url = id ? `/api/riddles/${id}` : '/api/riddles';
            const method = id ? 'PUT' : 'POST';

            await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body)
            });

            cancelEdit();
            loadRiddles();
        }

        function editRiddle(id) {
            const r = allRiddles.find(i => i.id === id);
            document.getElementById('edit-id').value = r.id;
            document.getElementById('question').value = r.question;
            document.getElementById('answer').value = r.answer;
            document.getElementById('category').value = r.category;
            document.getElementById('explanation').value = r.explanation || "";
            
            document.getElementById('form-title').innerText = "–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–≥–∞–¥–∫—É üìù";
            document.getElementById('btn-save').innerText = "–û–ë–ù–û–í–ò–¢–¨";
            document.getElementById('btn-cancel').style.display = 'block';
            window.scrollTo(0,0);
        }

        function cancelEdit() {
            document.getElementById('edit-id').value = '';
            document.getElementById('question').value = '';
            document.getElementById('answer').value = '';
            document.getElementById('explanation').value = '';
            document.getElementById('form-title').innerText = "–î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–∞–¥–∫—É üîÆ";
            document.getElementById('btn-save').innerText = "–°–û–•–†–ê–ù–ò–¢–¨";
            document.getElementById('btn-cancel').style.display = 'none';
        }

        async function deleteRiddle(id) {
            if(confirm("–£–¥–∞–ª–∏—Ç—å?")) {
                await fetch(`/api/admin/riddles/${id}`, { method: 'DELETE' });
                loadRiddles();
            }
        }
    </script>
</body>
</html>
